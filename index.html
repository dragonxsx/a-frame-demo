<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.min.js"></script>
    <script>THREEx.ArToolkitContext.baseURL = 'https://jeromeetienne.github.io/AR.js/three.js/'</script>
    <script src="main.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css"/>
    <script>
        function deviceMotionListener(event) {
            var x = event.accelerationIncludingGravity.x;
            var y = event.accelerationIncludingGravity.y;
            var z = event.accelerationIncludingGravity.z;			
            document.querySelector('#x1').innerText = x;
            document.querySelector('#y1').innerText = y;
            document.querySelector('#z1').innerText = z;

            x = event.acceleration.x;
            y = event.acceleration.y;
            z = event.acceleration.z;
            document.querySelector('#x2').innerText = x;
            document.querySelector('#y2').innerText = y;
            document.querySelector('#z2').innerText = z;	
        }

        function deviceOrientationListener(event) {
            var alpha = event.alpha;
            var beta = event.beta;
            var gamma = event.gamma;
            document.querySelector('#alpha').innerText = alpha;
            document.querySelector('#beta').innerText = beta;
            document.querySelector('#gamma').innerText = gamma;
        }

        // Add a event listener for tracking camera's position and rotation
        window.onload = function () {

            var camera = document.getElementById('camera');

            camera.addEventListener('componentchanged', function (evt) {
                switch (evt.detail.name) {
                    case 'rotation':
                        //console.log('camera rotation changed', evt.detail.newData);
                        var compassRotation = camera.components['compass-rotation'];
                        var lookControls = camera.components['look-controls'];
                        camera_angle.innerText = evt.detail.newData.y;
                        if (lookControls) {
                            yaw_angle.innerText = THREE.Math.radToDeg(lookControls.yawObject.rotation.y);
                        }

                        if (compassRotation) {
                            compass_heading.innerText = compassRotation.heading;
                            device_orientation.innerText = compassRotation.currentOrientation;
                        }
                        break;
                    case 'position':
                        //console.log('camera position changed', evt.detail.newData);
                        var gpsPosition = camera.components['gps-position'];
                        camera_p_x.innerText = evt.detail.newData.x;
                        camera_p_z.innerText = evt.detail.newData.z;
                        if (gpsPosition) {
                            if (gpsPosition.coords) {
                                crd_longitude.innerText = gpsPosition.coords.longitude;
                                crd_latitude.innerText = gpsPosition.coords.latitude;
                                crd_accuracy.innerText = gpsPosition.coords.accuracy;
                            }
                            if (gpsPosition.zeroCoords) {
                                zero_crd_longitude.innerText = gpsPosition.zeroCoords.longitude;
                                zero_crd_latitude.innerText = gpsPosition.zeroCoords.latitude;
                            }
                        }

                        break;
                }
            });
    
            if (window.DeviceOrientationEvent) {
                window.addEventListener("deviceorientation", deviceOrientationListener);
              } else {
                alert("Sorry, your browser doesn't support Device Orientation");
              }
    
            if('ondevicemotion' in window) {
                 window.addEventListener('devicemotion', deviceMotionListener);
            }
        };
    </script>
</head>

<body>

    <div id="tracking-panel">
        <div>
            coords:
            <span id="crd_longitude"></span>,
            <span id="crd_latitude"></span><br>

            (zero coords:
            <span id="zero_crd_longitude"></span>,
            <span id="zero_crd_latitude"></span>)<br>

            GPS accuracy:
            <span id="crd_accuracy"></span><br>

            Acceleration Including Gravity:<br>
            x: <span id="x1"></span><br>
            y: <span id="y1"></span><br>
            z: <span id="z1"></span><br><br>
    
            Acceleration:<br>
            x: <span id="x2"></span><br>
            y: <span id="y2"></span><br>
            z: <span id="z2"></span><br><br>
    
            Gyroscope:<br>
            alpha: <span id="alpha"></span><br>
            beta: <span id="beta"></span><br>
            gamma: <span id="gamma"></span><br>

            compass heading:
                <span id="compass_heading"><br>
        </div>
        <div>
            camera coords:
            <span id="camera_p_x"></span>,
            <span id="camera_p_z"></span><br>
        </div>
        <div>
            camera angle:
            <span id="camera_angle"></span>, yaw angle:
            <span id="yaw_angle"></span><br>
        </div>
        <div>
            Device device orientation:
            <span id="device_orientation">
        </div>
    </div>

    <div class="compass">
        <div id="rose" class="compass__rose">
            <svg class="compass__rose__dial" viewBox="0 0 130 130" version="1.1" xmlns="http://www.w3.org/2000/svg">
                <circle cx="65" cy="65" r="56" stroke="white" stroke-width="1" fill="none" />
                <polyline points="63,9  67,9  65,13" fill="white"/>
                <polyline points="121,63  121,67  119,65" fill="white"/>
                <polyline points="63,121  67,121  65,119" fill="white"/>
                <polyline points="9,63  9,67  11,65" fill="white"/>
        
                <text x="65" y="4.2" font-size="5" text-anchor="middle" fill="white">N</text>
                <text x="127" y="67" font-size="5" text-anchor="middle" fill="white">E</text>
                <text x="65" y="129" font-size="5" text-anchor="middle" fill="white">S</text>
                <text x="2.8" y="67" font-size="5" text-anchor="middle" fill="white">W</text>
            </svg>
        </div>
    
        <svg class="compass__pointer" viewBox="0 0 130 130" version="1.1" xmlns="http://www.w3.org/2000/svg">
            <polyline points="60,60  70,60  65,15" fill="#b60000"/>
            <polyline points="60,70  70,70  65,115" fill="white"/>
            <circle cx="65" cy="65" r="7" stroke="#b60000" stroke-width="7" fill="none" />
        </svg>
    </div>

    <a-scene embedded arjs="sourceType: webcam;">
        <a-camera id="camera" user-height="1.6" gps-position compass-rotation>
        </a-camera>

        <a-entity road>
        </a-entity>
    </a-scene>

    <script>
            
    </script>
</body>

</html>